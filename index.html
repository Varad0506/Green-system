<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Green System | Live Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #061a12; color: white; margin: 0; overflow-x: hidden; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .green-gradient { background: radial-gradient(circle at top, #064e3b 0%, #061a12 100%); }
        .recycle-spin { animation: rotate 3s linear infinite; }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        #physics-container { position: absolute; inset: 0; z-index: 10; }
        .hidden-section { display: none; opacity: 0; transition: opacity 0.5s; }
        .btn-locked { opacity: 0.2; pointer-events: none; filter: grayscale(1); }
        .flash { animation: flashAnim 0.2s ease-out; }
        @keyframes flashAnim { 0% { background: white; } 100% { background: transparent; } }
    </style>
</head>
<body>

    <div id="loading-screen" class="fixed inset-0 z-[100] green-gradient flex flex-col items-center justify-center">
        <i data-lucide="refresh-cw" class="w-16 h-16 text-emerald-400 recycle-spin"></i>
        <h1 class="mt-6 text-xl font-black tracking-widest text-emerald-100 uppercase tracking-tighter">Green System</h1>
    </div>

    <div id="unlock-screen" class="fixed inset-0 z-50 bg-[#080808] hidden flex-col items-center justify-center">
        <div id="physics-container"></div>
        <div class="relative z-20 text-center mb-[400px] pointer-events-none px-6">
            <h2 class="text-3xl font-black uppercase italic text-emerald-400">Green System</h2>
            <p class="text-white/40 text-sm">Drag trash to bin to access portal</p>
        </div>
        <div id="ui-bin" class="fixed bottom-24 left-1/2 -translate-x-1/2 w-32 h-32 flex items-center justify-center border-2 border-dashed border-emerald-500/20 rounded-full">
            <i data-lucide="trash-2" class="w-12 h-12 text-emerald-500/30"></i>
        </div>
    </div>

    <main id="main-app" class="hidden-section min-h-screen p-6 max-w-lg mx-auto pb-20">
        <header class="mb-8 flex justify-between items-center">
            <h1 class="text-xl font-black text-emerald-400 italic tracking-tighter">GREEN SYSTEM</h1>
            <div class="flex items-center gap-2 px-3 py-1 glass rounded-full">
                <div class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></div>
                <span class="text-[9px] font-bold opacity-70">LIVE SESSION</span>
            </div>
        </header>

        <form id="report-form" class="space-y-6">
            <input type="hidden" name="latitude" id="hidden-lat">
            <input type="hidden" name="longitude" id="hidden-lng">
            
            <div class="glass p-5 rounded-[2.5rem] border-emerald-500/10">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold flex items-center gap-2"><i data-lucide="camera" class="w-4 h-4 text-emerald-400"></i> Evidence</h3>
                    <span id="p-status" class="text-[9px] bg-red-500/20 text-red-400 px-2 py-1 rounded-md uppercase font-black">Missing</span>
                </div>
                <div id="cam-area" class="aspect-square bg-black rounded-3xl relative overflow-hidden flex items-center justify-center border border-white/5 shadow-inner">
                    <video id="video" class="absolute inset-0 w-full h-full object-cover"></video>
                    <canvas id="canvas" class="hidden absolute inset-0 w-full h-full object-cover"></canvas>
                    <div id="flash-overlay" class="absolute inset-0 z-20 pointer-events-none"></div>
                    <p id="cam-hint" class="text-[10px] uppercase font-bold text-white/20">Awaiting visual...</p>
                </div>
                <div class="mt-4 flex gap-3">
                    <button type="button" onclick="startCamera()" id="btn-open" class="flex-1 py-4 bg-white/5 text-white rounded-xl font-bold text-xs uppercase tracking-widest border border-white/10">Open Lens</button>
                    <button type="button" onclick="takePhoto()" id="btn-snap" class="hidden flex-1 py-4 bg-white text-black rounded-xl font-black text-xs uppercase tracking-widest">Snap Capture</button>
                </div>
            </div>

            <div class="glass p-5 rounded-[2.5rem] border-emerald-500/10">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold flex items-center gap-2"><i data-lucide="map-pin" class="w-4 h-4 text-emerald-400"></i> Live Location</h3>
                    <span id="l-status" class="text-[9px] bg-red-500/20 text-red-400 px-2 py-1 rounded-md uppercase font-black">Inactive</span>
                </div>
                <button type="button" onclick="getGPS()" id="btn-gps" class="w-full py-5 bg-emerald-600/20 text-emerald-400 border border-emerald-500/30 rounded-2xl font-black text-xs uppercase tracking-widest flex items-center justify-center gap-2 active:scale-95 transition-all">
                    <i data-lucide="locate-fixed" class="w-4 h-4"></i> Fetch Current GPS
                </button>
                <div class="grid grid-cols-2 gap-3 mt-4">
                    <div class="bg-black/40 p-3 rounded-xl border border-white/5 text-center">
                        <span class="text-[9px] text-white/30 uppercase block">Lat</span>
                        <span id="d-lat" class="font-mono text-emerald-400 text-xs">--.----</span>
                    </div>
                    <div class="bg-black/40 p-3 rounded-xl border border-white/5 text-center">
                        <span class="text-[9px] text-white/30 uppercase block">Lng</span>
                        <span id="d-lng" class="font-mono text-emerald-400 text-xs">--.----</span>
                    </div>
                </div>
            </div>

            <div class="pt-2">
                <button type="submit" id="sub-btn" class="btn-locked w-full py-6 bg-emerald-400 text-black font-black rounded-[2.5rem] uppercase tracking-tighter text-xl shadow-2xl shadow-emerald-500/20">
                    Transmit Report
                </button>
                <p id="err-msg" class="text-center text-[10px] text-red-400/60 mt-4 uppercase tracking-widest font-bold">Photo + GPS Required to proceed</p>
            </div>
        </form>
    </main>

    <div id="success-screen" class="fixed inset-0 z-[110] green-gradient hidden flex-col items-center justify-center text-center p-8 opacity-0">
        <div class="p-6 bg-emerald-400/10 rounded-full mb-6">
            <i data-lucide="shield-check" class="w-20 h-20 text-emerald-400"></i>
        </div>
        <h2 class="text-4xl font-black mb-2 uppercase italic tracking-tighter">Transmission Secured</h2>
        <p class="opacity-50 text-xs mb-10 max-w-[200px] mx-auto">Report logged at coderbro06@gmail.com with precise coordinates.</p>
        <button onclick="location.reload()" class="px-12 py-5 bg-white text-black rounded-full font-black uppercase text-xs tracking-widest">Restart System</button>
    </div>

    <script>
        lucide.createIcons();
        let state = { photo: false, gps: false };
        let vStream = null;

        // 1. Loader (5s)
        setTimeout(() => {
            document.getElementById('loading-screen').style.display = 'none';
            initPhys();
        }, 5000);

        // 2. Physics Unlock
        function initPhys() {
            document.getElementById('unlock-screen').style.display = 'flex';
            const { Engine, Render, Runner, Bodies, Composite, MouseConstraint, Mouse, Events } = Matter;
            const engine = Engine.create();
            const render = Render.create({ element: document.getElementById('physics-container'), engine: engine, options: { width: window.innerWidth, height: window.innerHeight, wireframes: false, background: 'transparent' } });
            const bag = Bodies.circle(window.innerWidth/2, 100, 40, { restitution: 0.5, render: { sprite: { texture: 'https://cdn-icons-png.flaticon.com/512/1041/1041916.png', xScale: 0.13, yScale: 0.13 } } });
            const floor = Bodies.rectangle(window.innerWidth/2, window.innerHeight+20, window.innerWidth, 40, { isStatic: true });
            Composite.add(engine.world, [bag, floor, MouseConstraint.create(engine, { mouse: Mouse.create(render.canvas) })]);
            Render.run(render);
            Runner.run(Runner.create(), engine);

            Events.on(engine, 'afterUpdate', () => {
                const bin = document.getElementById('ui-bin').getBoundingClientRect();
                const d = Math.hypot(bag.position.x - (bin.left + 64), bag.position.y - (bin.top + 64));
                if (d < 50) {
                    document.getElementById('unlock-screen').style.display = 'none';
                    const main = document.getElementById('main-app');
                    main.style.display = 'block';
                    setTimeout(() => main.style.opacity = '1', 50);
                }
            });
        }

        // 3. Camera
        async function startCamera() {
            try {
                vStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                const video = document.getElementById('video');
                video.srcObject = vStream;
                video.play();
                document.getElementById('cam-hint').classList.add('hidden');
                document.getElementById('btn-open').classList.add('hidden');
                document.getElementById('btn-snap').classList.remove('hidden');
            } catch (e) { alert("Camera Permission Required"); }
        }

        function takePhoto() {
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const flash = document.getElementById('flash-overlay');
            flash.classList.add('flash');
            setTimeout(() => flash.classList.remove('flash'), 200);

            canvas.width = video.videoWidth; canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            
            vStream.getTracks().forEach(t => t.stop());
            video.classList.add('hidden');
            canvas.classList.remove('hidden');
            state.photo = true;
            
            updateStatus('p-status', 'Verified ✓');
            checkForm();
        }

        // 4. GPS
        function getGPS() {
            const btn = document.getElementById('btn-gps');
            btn.innerText = "LOCALIZING...";
            
            navigator.geolocation.getCurrentPosition((p) => {
                const lat = p.coords.latitude.toFixed(6);
                const lng = p.coords.longitude.toFixed(6);
                
                document.getElementById('d-lat').innerText = lat;
                document.getElementById('d-lng').innerText = lng;
                document.getElementById('hidden-lat').value = lat;
                document.getElementById('hidden-lng').value = lng;
                
                state.gps = true;
                updateStatus('l-status', 'Locked ✓');
                btn.innerText = "GPS SYNCED";
                btn.classList.add('opacity-50', 'pointer-events-none');
                checkForm();
            }, (err) => {
                alert("GPS Denied. Please enable location.");
                btn.innerText = "FETCH LIVE GPS";
            });
        }

        function updateStatus(id, text) {
            const el = document.getElementById(id);
            el.innerText = text;
            el.classList.replace('bg-red-500/20', 'bg-emerald-500/20');
            el.classList.replace('text-red-400', 'text-emerald-400');
        }

        function checkForm() {
            if(state.photo && state.gps) {
                document.getElementById('sub-btn').classList.remove('btn-locked');
                document.getElementById('err-msg').classList.add('hidden');
            }
        }

        // 5. Submit
        document.getElementById('report-form').onsubmit = async (e) => {
            e.preventDefault();
            const btn = document.getElementById('sub-btn');
            btn.innerText = "TRANSMITTING...";
            
            try {
                await fetch("https://formspree.io/f/coderbro06@gmail.com", {
                    method: "POST",
                    body: new FormData(e.target),
                    headers: { 'Accept': 'application/json' }
                });
            } catch (err) {}

            document.getElementById('main-app').style.display = 'none';
            const ss = document.getElementById('success-screen');
            ss.classList.replace('hidden', 'flex');
            setTimeout(() => ss.style.opacity = '1', 50);
        }
    </script>
</body>
</html>




